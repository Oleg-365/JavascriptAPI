<!DOCTYPE html>
<html>

<head>
	<title>Бесконечная лента с фоттографиями</title>
	<style>
		#photo-container {
			display: flex;
			flex-wrap: wrap;
		}

		.photo {
			flex: 1 1 calc(33.33% - 20px);
			margin: 10px;
			border: 1px solid #ccc;
			box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.3);
			overflow: hidden;
		}

		.photo img {
			width: 100%;
			height: auto;
		}
	</style>
</head>

<body>
	<div id="photo-container">

	</div>
	<script>
		const accessKey = "LzuUz9AjbvXzq_Zt0fa48JBHMzA3oidrigOCg3EPAgo";

		let isFetching = true;


		const fetchPhotos = async (page) => { // асинхронные функции всегда возращают промис

			try {
				const response = await fetch(`https://api.unsplash.com/photos/?page=${page}&client_id=${accessKey}`);

				if (!response.ok) {
					throw new Error('Ошибка при загрузке данных');
				}
				const data = await response.json();
				return data;
			}
			catch {
				throw error;
			}
			finally {
				isFetching = false;
			}
		}

		let currentPage = 1;
		const photoContainer = document.querySelector('#photo-container');

		async function run() {
			try {
				const data = await fetchPhotos(currentPage);
				console.log(data);
				addPhotoinHTML(data);
			} catch (error) {
				const errorMessage = document.createElement("div");
				errorMessage.textContent = error.message;
				photoContainer.append(errorMessage);
			}

		}
		run();


		function addPhotoinHTML(data) {
			for (let obj of data) {
				photoContainer.insertAdjacentHTML('beforeend', `
					<div class="photo">
						<img src="${obj.urls.small}" alt="${obj.urls.description}"
					</div>
				`)
			}
		}

		window.addEventListener('scroll', async () => {

			const percentPage = window.scrollY / (document.body.clientHeight - window.innerHeight) * 100;
			console.log(document.body.clientHeight); // высота документа со всем дивами и проч.
			console.log(percentPage);

			if (percentPage >= 90 && !isFetching) {
				isFetching = true;
				currentPage++;
				console.log('Подгружаем еще фоток');
				try {
					const data = await fetchPhotos(currentPage);
					addPhotoinHTML(data);
				}
				catch (error) {
					alert(error.message);
				}
			}
		})
	</script>
</body>

</html>